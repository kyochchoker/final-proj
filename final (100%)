import tkinter as tk
import json 

notices = []
notice_file = "notices.json"
teachers_file = "teachers.json"
current_user = None

def load_notices():
    global notices
    try:
        with open(notice_file) as json_data:
            notices = json.load(json_data)
    except FileNotFoundError:
        notices = []
    except json.decoder.JSONDecodeError:
        notices = []

def load_teachers():
    global teachers
    try:
        with open(teachers_file) as json_data:
            teachers = json.load(json_data)
    except FileNotFoundError:
        save_teachers()
    except json.decoder.JSONDecodeError:
        teachers = {}

def save_teachers():
    with open(teachers_file, "w") as json_data:
        json.dump(teachers, json_data, indent=4)

def save_notices():
    with open(notice_file, "w") as json_data:
        json.dump(notices, json_data)

def validate_teacher_id(tid):
    """Validate that teacher ID is max 10 characters"""
    return len(tid) <= 10

def validate_password(pwd):
    """Validate that password is at least 8 characters"""
    return len(pwd) >= 8

def register():
    regis_window = tk.Toplevel(window)
    regis_window.title("Registration")
    regis_window.geometry("600x750")  
    regis_window.resizable(False, False)
    regis_window.configure(bg="white")
    
    regis_window.transient(window)
    regis_window.grab_set()
    
    try:
        if 'icon' in globals() and icon:
            regis_window.iconphoto(False, icon)
    except:
        pass

    title_label = tk.Label(regis_window, text="Teacher Registration", font=("Helvetica", 24, "bold"), bg="white")
    title_label.pack(pady=20)
    
    ln_label = tk.Label(regis_window, text="Last Name:", font=("Helvetica", 13), bg="white", anchor="w")
    ln_label.pack(pady=(10, 5), padx=50, fill="x")  
    ln_entry = tk.Entry(regis_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    ln_entry.pack(pady=5, padx=50, fill="x", ipady=6)  
    
    fn_label = tk.Label(regis_window, text="First Name:", font=("Helvetica", 13), bg="white", anchor="w")
    fn_label.pack(pady=(10, 5), padx=50, fill="x")
    fn_entry = tk.Entry(regis_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    fn_entry.pack(pady=5, padx=50, fill="x", ipady=6)
    
    mi_label = tk.Label(regis_window, text="Middle Initial (or N/A):", font=("Helvetica", 13), bg="white", anchor="w")
    mi_label.pack(pady=(10, 5), padx=50, fill="x")
    mi_entry = tk.Entry(regis_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    mi_entry.pack(pady=5, padx=50, fill="x", ipady=6)
    
    id_label = tk.Label(regis_window, text="Teacher ID (max 10 characters):", font=("Helvetica", 13), bg="white", anchor="w")
    id_label.pack(pady=(10, 5), padx=50, fill="x")
    id_entry = tk.Entry(regis_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    id_entry.pack(pady=5, padx=50, fill="x", ipady=6)
    
    pwd_label = tk.Label(regis_window, text="Password (min 8 characters):", font=("Helvetica", 13), bg="white", anchor="w")
    pwd_label.pack(pady=(10, 5), padx=50, fill="x")
    pwd_entry = tk.Entry(regis_window, font=("Helvetica", 13), show="*", relief=tk.SOLID, bd=2)
    pwd_entry.pack(pady=5, padx=50, fill="x", ipady=6)
    
    confirm_pwd_label = tk.Label(regis_window, text="Confirm Password:", font=("Helvetica", 13), bg="white", anchor="w")
    confirm_pwd_label.pack(pady=(10, 5), padx=50, fill="x")
    confirm_pwd_entry = tk.Entry(regis_window, font=("Helvetica", 13), show="*", relief=tk.SOLID, bd=2)
    confirm_pwd_entry.pack(pady=5, padx=50, fill="x", ipady=6)
    
    error_label = tk.Label(regis_window, text="", font=("Helvetica", 11), bg="white", fg="red")
    error_label.pack(pady=3) 
    
    def submit():
        ln = ln_entry.get().strip()
        fn = fn_entry.get().strip()
        mi = mi_entry.get().strip()
        tid = id_entry.get().strip()
        pwd = pwd_entry.get().strip()
        confirm_pwd = confirm_pwd_entry.get().strip()
        
        if not ln:
            error_label.config(text="Error: Last Name is required!")
            return
        if not fn:
            error_label.config(text="Error: First Name is required!")
            return
        if not mi:
            error_label.config(text="Error: Middle Initial is required! (Use N/A if not applicable)")
            return
        if not tid:
            error_label.config(text="Error: Teacher ID is required!")
            return
        if not pwd:
            error_label.config(text="Error: Password is required!")
            return
        
        if not confirm_pwd:
            error_label.config(text="Error: Confirm Password is required!")
            return
        
        if not validate_teacher_id(tid):
            error_label.config(text="Error: Teacher ID must be max 10 characters!")
            return
        
        if not validate_password(pwd):
            error_label.config(text="Error: Password must be at least 8 characters!")
            return

        if pwd != confirm_pwd:
            error_label.config(text="Error: Passwords do not match!")
            return
        
        if tid in teachers:
            error_label.config(text="Error: Teacher ID already exists!")
            return
        
        full_name = f"{ln}, {fn}, {mi}"
        
        teachers[tid] = {"password": pwd, "name": full_name}
        save_teachers()
        
        error_label.config(text="", fg="green")
        regis_window.destroy()
        
    register_btn = tk.Button(regis_window, text="Register", command=submit, font=("Helvetica", 14, "bold"), bg="#90EE90", fg="#1a1a1a", width=25, height=2, relief=tk.FLAT, cursor="hand2") 
    register_btn.pack(pady=15)  
    
    regis_window.focus_set()
    ln_entry.focus()

def login():
    global current_user
    
    login_window = tk.Toplevel(window)
    login_window.title("Login")
    login_window.geometry("600x500")
    login_window.resizable(False, False)
    login_window.configure(bg="white")
    
    login_window.transient(window)
    login_window.grab_set()

    try:
        if 'icon' in globals() and icon:
            login_window.iconphoto(False, icon)
    except:
        pass
    
    title_label = tk.Label(login_window, text="Teacher Login", font=("Helvetica", 24, "bold"), bg="white")
    title_label.pack(pady=40)
    
    id_label = tk.Label(login_window, text="Teacher ID (max 10 characters):", font=("Helvetica", 13), bg="white", anchor="w")
    id_label.pack(pady=(20, 8), padx=50, fill="x")
    id_entry = tk.Entry(login_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    id_entry.pack(pady=8, padx=50, fill="x", ipady=8)
    
    pwd_label = tk.Label(login_window, text="Password:", font=("Helvetica", 13), bg="white", anchor="w")
    pwd_label.pack(pady=(20, 8), padx=50, fill="x")
    pwd_entry = tk.Entry(login_window, font=("Helvetica", 13), show="*", relief=tk.SOLID, bd=2)
    pwd_entry.pack(pady=8, padx=50, fill="x", ipady=8)
    
    def submit_login():
        global current_user
        tid = id_entry.get().strip()
        pwd = pwd_entry.get().strip()

        if not tid or not pwd:
            return
        
        if not validate_teacher_id(tid):
            return
        
        if tid == "admin" and pwd == "admin123":
            current_user = "admin"
            window.title("Notice Board - Admin")
            status_label.config(text="Logged in as: Admin")
            btn_add.config(state=tk.NORMAL)
            btn_edit.config(state=tk.NORMAL)
            btn_remove.config(state=tk.NORMAL)
            btn_view_notice.config(state=tk.NORMAL)
            btn_register.config(state=tk.NORMAL)
            btn_login.config(state=tk.NORMAL, text="Log Out", command=logout)
            show_board()
            login_window.destroy()
        
        elif tid in teachers and teachers[tid]["password"] == pwd:
            current_user = tid
            window.title(f"Notice Board - Teacher: {teachers[tid]['name']}")
            status_label.config(text=f"Logged in as: {teachers[tid]['name']}")
            btn_add.config(state=tk.DISABLED)
            btn_edit.config(state=tk.DISABLED)
            btn_remove.config(state=tk.DISABLED)
            btn_view_notice.config(state=tk.NORMAL)
            btn_register.config(state=tk.DISABLED)
            btn_login.config(state=tk.NORMAL, text="Log Out", command=logout)
            show_board()
            login_window.destroy()
        else:
            return 
    
    login_btn = tk.Button(login_window, text="Login", command=submit_login, font=("Helvetica", 14, "bold"), bg="#87CEEB", fg="#1a1a1a", width=25, height=3, relief=tk.FLAT, cursor="hand2")
    login_btn.pack(pady=40)
    
    login_window.focus_set()
    id_entry.focus()

def add():
    add_window = tk.Toplevel(window)
    add_window.title("Add Notice")
    add_window.geometry("700x600")
    add_window.resizable(False, False)
    add_window.configure(bg="white")
    
    add_window.transient(window)
    add_window.grab_set()

    try:
        if 'icon' in globals() and icon:
            add_window.iconphoto(False, icon)
    except:
        pass
    
    header_label = tk.Label(add_window, text="Add New Notice", font=("Helvetica", 24, "bold"), bg="white")
    header_label.pack(pady=40)
    
    title_label = tk.Label(add_window, text="Notice Title:", font=("Helvetica", 13), bg="white", anchor="w")
    title_label.pack(pady=(15, 8), padx=50, fill="x")
    title_entry = tk.Entry(add_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    title_entry.pack(pady=8, padx=50, fill="x", ipady=8)
    
    desc_label = tk.Label(add_window, text="Notice Description:", font=("Helvetica", 13), bg="white", anchor="w")
    desc_label.pack(pady=(20, 8), padx=50, fill="x")
    desc_text = tk.Text(add_window, font=("Helvetica", 12), relief=tk.SOLID, bd=2, height=10, wrap=tk.WORD)
    desc_text.pack(pady=8, padx=50, fill="both", expand=True)

    
    
    def submit_notice():
        title = title_entry.get().strip()
        description = desc_text.get("1.0", tk.END).strip()
        
        if not title:
            return
        
        if not description:
            return
        
        notice = {"title": title, "description": description}
        notices.append(notice)
        save_notices()
        show_board()
        add_window.destroy()
    
    add_btn = tk.Button(add_window, text="Add Notice", command=submit_notice, font=("Helvetica", 14, "bold"), bg="#90EE90", fg="#1a1a1a", width=25, height=3, relief=tk.FLAT, cursor="hand2")
    add_btn.pack(pady=20)
    
    add_window.focus_set()
    title_entry.focus()

def edit():
    sel = listbox.curselection()
    if not sel:
        return 
    index = sel[0]

    if not notices or index >= len(notices):
         return 
    
    selected_notice = notices[index]
    
    if isinstance(selected_notice, str):
        old_title = selected_notice
        old_desc = ""
    else:
        old_title = selected_notice.get("title", "")
        old_desc = selected_notice.get("description", "")
    
    edit_window = tk.Toplevel(window)
    edit_window.title("Edit Notice")
    edit_window.geometry("700x600")
    edit_window.resizable(False, False)
    edit_window.configure(bg="white")
    
    edit_window.transient(window)
    edit_window.grab_set()

    try:
        if 'icon' in globals() and icon:
            edit_window.iconphoto(False, icon)
    except:
        pass
    
    header_label = tk.Label(edit_window, text="Edit Notice", font=("Helvetica", 24, "bold"), bg="white")
    header_label.pack(pady=40)
    
    title_label = tk.Label(edit_window, text="Notice Title:", font=("Helvetica", 13), bg="white", anchor="w")
    title_label.pack(pady=(15, 8), padx=50, fill="x")
    title_entry = tk.Entry(edit_window, font=("Helvetica", 13), relief=tk.SOLID, bd=2)
    title_entry.pack(pady=8, padx=50, fill="x", ipady=8)
    title_entry.insert(0, old_title)
    
    desc_label = tk.Label(edit_window, text="Notice Description:", font=("Helvetica", 13), bg="white", anchor="w")
    desc_label.pack(pady=(20, 8), padx=50, fill="x")
    desc_text = tk.Text(edit_window, font=("Helvetica", 12), relief=tk.SOLID, bd=2, height=10, wrap=tk.WORD)
    desc_text.pack(pady=8, padx=50, fill="both", expand=True)
    desc_text.insert("1.0", old_desc)

    
    
    def submit_edit():
        title = title_entry.get().strip()
        description = desc_text.get("1.0", tk.END).strip()
        
        

        if not title:
            return
        
        if not description:
            return
        
        notices[index] = {"title": title, "description": description}
        save_notices()
        show_board()
        
        edit_window.destroy()
    
    update_btn = tk.Button(edit_window, text="Update Notice", command=submit_edit, font=("Helvetica", 14, "bold"), bg="#FFD699", fg="#1a1a1a", width=25, height=3, relief=tk.FLAT, cursor="hand2")
    update_btn.pack(pady=20)
    
    edit_window.focus_set()
    title_entry.focus()

def remove():
    sel = listbox.curselection()
    if not sel:
        return 
    
    index = sel[0]
    
    if not notices or index >= len(notices):
         return 
    
    
    def confirm_removal():
        confirm_window = tk.Toplevel(window)
        confirm_window.title("Confirm Removal")
        confirm_window.geometry("400x200")
        confirm_window.resizable(False, False)
        confirm_window.transient(window)
        confirm_window.grab_set()

        
        try:
            if 'icon' in globals() and icon:
                confirm_window.iconphoto(False, icon)
        except:
            pass
        

        tk.Label(confirm_window, text="Confirm Deletion:", font=("Helvetica", 12, "bold")).pack(pady=20)
        
        confirm_entry = tk.Entry(confirm_window, font=("Helvetica", 11), relief=tk.SOLID, bd=2)
        confirm_entry.insert(0, "Type 'YES' to confirm")
        confirm_entry.pack(pady=5, padx=20, fill="x", ipady=5)

        
        
        def process_confirmation():
            if confirm_entry.get().strip().upper() == "YES":
                notices.pop(index)
                save_notices()
                show_board()
                confirm_window.destroy()
            else:
                return 

        btn_frame = tk.Frame(confirm_window)
        btn_frame.pack(pady=10)

        tk.Button(btn_frame, text="Confirm", command=process_confirmation, font=("Helvetica", 11, "bold"), bg="#FF9999",relief=tk.FLAT, width=10).pack(side=tk.LEFT, padx=10)
        tk.Button(btn_frame, text="Cancel", command=confirm_window.destroy, font=("Helvetica", 11, "bold"), bg="#D3D3D3",relief=tk.FLAT,     width=10).pack(side=tk.LEFT, padx=10)

        confirm_window.focus_set()
        confirm_entry.focus()

    confirm_removal()

def view():
    sel = listbox.curselection()
    if not sel:
        return 
    
    index = sel[0]
    
    if not notices or index >= len(notices):
         return 
         
    selected_notice = notices[index]
    
    if isinstance(selected_notice, dict):
        notice_text = selected_notice.get('description', 'No description provided.')
        notice_title = selected_notice.get('title', 'Notice Details')
    else:
        notice_text = selected_notice
        notice_title = "Notice"
    
    view_window = tk.Toplevel(window)
    view_window.title(f"View Notice - {notice_title}")
    view_window.geometry("900x700")
    view_window.resizable(True, True) 
    view_window.configure(bg="white")
    
    view_window.transient(window)
    view_window.grab_set()

    
    try:
        if 'icon' in globals() and icon:
            view_window.iconphoto(False, icon)
    except:
        pass
    
    
    title_label = tk.Label(view_window, text=notice_title, font=("Helvetica", 16, "bold"), bg="lightblue", pady=10)
    title_label.pack(pady=5, padx=10, fill="x")
    
    text_frame = tk.Frame(view_window, padx=20, pady=15)
    text_frame.pack(fill="both", expand=True) 

    scrollbar = tk.Scrollbar(text_frame)
    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

    text_widget = tk.Text(text_frame, font=("Helvetica", 13), relief=tk.SOLID, bd=2, wrap=tk.WORD, padx=15, pady=15, yscrollcommand=scrollbar.set)
    text_widget.pack(side=tk.LEFT, fill="both", expand=True) 

    scrollbar.config(command=text_widget.yview)
    
    text_widget.insert("1.0", notice_text)
    text_widget.config(state=tk.DISABLED)
    
    close_btn = tk.Button(view_window, text="Close", command=view_window.destroy, font=("Helvetica", 13, "bold"), bg="#D8BFD8", fg="#1a1a1a", width=25, height=3, relief=tk.FLAT, cursor="hand2")
    close_btn.pack(pady=20, padx=20)

def logout():
    global current_user
    current_user = None
    window.title("Notice Board")
    status_label.config(text="Logged in as: None")
    btn_add.config(state=tk.DISABLED)
    btn_edit.config(state=tk.DISABLED)
    btn_remove.config(state=tk.DISABLED)
    btn_view_notice.config(state=tk.DISABLED)
    btn_register.config(state=tk.NORMAL)
    btn_login.config(state=tk.NORMAL, text="Login", command=login)
    show_board()

def show_board():
    listbox.delete(0, tk.END)
    if current_user is None:
        listbox.insert(tk.END, "(* Please sign in to check notices *)")
        return

    if not notices:
        listbox.insert(tk.END, "(* No notices available *)")
        return

    for i, notice in enumerate(notices, 1):
        if isinstance(notice, dict):
            listbox.insert(tk.END, f"{i}. {notice['title']}")
        else:
            listbox.insert(tk.END, f"{i}. {notice}")


window = tk.Tk()
window.title("Notice Board")
window.geometry("1100x700")
window.resizable(True, True) 

icon = None
photo1 = None

try:
    window.iconbitmap("noticeboard.png")
except:
    pass
try:
    window.iconbitmap("noticeboard.ico")
except:
    pass
try:
    
    icon = tk.PhotoImage(file='D:\pie thon\\icons\\noticeboard.png')
    window.iconphoto(False, icon)
    
    photo1 = icon.subsample(6, 6)
except:
    photo1 = None

title = tk.Label(window, text="The Notice Board", font=("Montserrat", 18, "bold"), image=photo1, compound="left")
title.pack(pady=10)

listbox_frame = tk.Frame(window, padx=15, pady=15)
listbox_frame.pack(fill="both", expand=True)

listbox_scrollbar = tk.Scrollbar(listbox_frame)
listbox_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

listbox = tk.Listbox(listbox_frame, height=22, relief=tk.FLAT, font=("Montserrat", 11), yscrollcommand=listbox_scrollbar.set)
listbox.pack(side=tk.LEFT, fill="both", expand=True)

listbox_scrollbar.config(command=listbox.yview)

frame = tk.Frame(window)
frame.pack(pady=8)

frame2 = tk.Frame(window) 
frame2.pack(pady=8)

btn_login = tk.Button(frame, text="Login", command=login, relief=tk.FLAT, width=15, height=2, bg="#87CEEB", fg="#1a1a1a", font=("Helvetica", 12, "bold"))
btn_login.pack(side=tk.LEFT, padx=8)

btn_add = tk.Button(frame, text="Add", command=add, width=15, height=2, relief=tk.FLAT, bg="#90EE90", fg="#1a1a1a", font=("Helvetica", 12, "bold"), state=tk.DISABLED)
btn_add.pack(side=tk.LEFT, padx=8)

btn_edit = tk.Button(frame, text="Edit", command=edit, width=15, height=2, relief=tk.FLAT, bg="#FFD699", fg="#1a1a1a", font=("Helvetica", 12, "bold"), state=tk.DISABLED)
btn_edit.pack(side=tk.LEFT, padx=8)

btn_remove = tk.Button(frame, text="Remove", command=remove, width=15, height=2, relief=tk.FLAT, bg="#FF9999", fg="#1a1a1a", font=("Helvetica", 12, "bold"), state=tk.DISABLED)
btn_remove.pack(side=tk.LEFT, padx=8)

btn_view_notice = tk.Button(frame, text="View", command=view, relief=tk.FLAT, width=15, height=2, bg="#D8BFD8", fg="#1a1a1a", font=("Helvetica", 12, "bold"), state=tk.DISABLED)
btn_view_notice.pack(side=tk.LEFT, padx=8)

btn_register = tk.Button(frame, text="Register", command=register, relief=tk.FLAT, width=15, height=2, bg="#E6B8FF", fg="#1a1a1a", font=("Helvetica", 12, "bold"))
btn_register.pack(padx=8)

status_label = tk.Label(window, text="Logged in as: None", font=("Helvetica", 11), fg="gray", justify=tk.LEFT)
status_label.pack(side=tk.BOTTOM, anchor=tk.SW, padx=15, pady=8)

load_notices()
load_teachers()
show_board() 

window.mainloop()
